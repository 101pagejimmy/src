{% extends "base.html" %}
{% load staticfiles %}
{% load static %}
{% load review_tags %}

{% block extrahead %}{% endblock %}

<style>
  {% block style %}
html,
body,
#map-canvas {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
}

#pac-input {
    left: 831px;
    margin-top: 30px;
    width: 50%;
    height: 50px;
    font-size: 20;
}
  {% endblock style %}
</style>


<body >
{% block content %}
{% include 'navbar.html' %}


<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>
<div class="container" id="map-canvas"></div>

<script>







 function init() {
   var map = new google.maps.Map(document.getElementById('map-canvas'), {
     center: {
       lat: 12.9715987,
       lng: 77.59456269999998
     },
     zoom: 10
   });


   var data = {{json_list|safe}}
   var markers = []
   var filters = {bike:false, trail:false, sail:false}


    $(function () {
    $('input[name=filter]').change(function (e) {
     map_filter(this.id);
      filter_markers()});
    })

    var get_set_options = function() {
      ret_array = []
      for (option in filters) {
        if (filters[option]) {
          ret_array.push(option)
        }
      }
      return ret_array;
    }

    var filter_markers = function() {  
      set_filters = get_set_options()
      
      // for each marker, check to see if all required options are set
      for (i = 0; i < markers.length; i++) {
        marker = markers[i];

        // start the filter check assuming the marker will be displayed
        // if any of the required features are missing, set 'keep' to false
        // to discard this marker
        keep=true
        for (opt=0; opt<set_filters.length; opt++) {
          if (!marker.properties[set_filters[opt]]) {
            keep = false;
          }
        }
        marker.setVisible(keep)
      }
    }

    var map_filter = function(id_val) {
       if (filters[id_val]) 
          filters[id_val] = false
       else
          filters[id_val] = true
    }


    var searchBox = new google.maps.places.SearchBox(document.getElementById('pac-input'));
    map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById('pac-input'));

    google.maps.event.addListener(searchBox, 'places_changed', function() {
     

      searchBox.set('map', null);
      var places = searchBox.getPlaces();
      var bounds = new google.maps.LatLngBounds();
      var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
      var icons = {
            sail: {icon: iconBase + 'sailing.png'},
            trail: {icon: iconBase + 'trail.png'},
            hike: {icon: iconBase + 'hiker.png'}};

      var i, place;
      for (i = 0; i < data.length; i++) {
         var position = new google.maps.LatLng(data[i]['fields']['latitude'], data[i]['fields']['longitude']);
         var json_tour_icon = data[i]['fields']['tour_icon'];

         (function(place) {
            var marker = new google.maps.Marker({
             position: position,
             map: map,
             icon: icons[json_tour_icon.toString()].icon,
             title: data[i]['fields']['title'],
           });

           marker.bindTo('map', searchBox, 'map');
           google.maps.event.addListener(marker, 'map_changed', function() {
              if (!this.getMap()) {
                 this.unbindAll();
             }
           });
          bounds.extend(places[0].geometry.location);
          }(place));
       }
      map.fitBounds(bounds);
      searchBox.set('map', map);
      map.setZoom(Math.min(map.getZoom(),12));
     });
   }

 google.maps.event.addDomListener(window, 'load', init);





    </script>

<input id="pac-input" class="controls" type="text" class="form-control" placeholder="Search Box">

<div id="buttons">
  
  <input type="checkbox" name="filter" id="sail" class='chk-btn'>
  <label for='sail'>Sail</label>
  
  <input type="checkbox" name="filter" id="trail" class='chk-btn'>
  <label for='trail'>Trail</label>
  
  <input type="checkbox" name="filter" id="hike" class='chk-btn'>
  <label for='hike'>Hike</label>
  <br>

</div>


{% endblock content %}
</html>


