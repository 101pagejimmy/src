{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load static %}
{% load review_tags %}

{% block extrahead %}{% endblock %}


<style>
  {% block style %}
html,
body,



#map {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
}

#pac-input {
    left: 831px;
    margin-top: 30px;
    width: 50%;
    height: 50px;
    font-size: 20;
}

  {% endblock style %}
</style>



<body >
{% block content %}
{% include 'navbar.html' %}

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places"></script>

<input id="pac-input" class="controls" type="text" class="form-control" placeholder="Search Box">
<div id='map'></div>
<script>

  function initMap() {
    map_options = {
      zoom: 10,
      mapTypeId: google.maps.MapTypeId.HYBRID,
      center: {lat: 45.5227326000, lng: -122.6758393000}
    }
    map_document = document.getElementById('map')
    map = new google.maps.Map(map_document,map_options);
    loadMarkers() 
  
}


var map
var markers = []
var searchBox = new google.maps.places.SearchBox(document.getElementById('pac-input'));        
var places = searchBox.getPlaces();
var bounds = new google.maps.LatLngBounds();
// start out with filter features set to false, so no filtering happens by default
var filters = {bike:false, trail:false, sail:false}
var data = {{json_list|safe}}


$(function () {
    $('input[name=filter]').change(function (e) {
     map_filter(this.id);
      filter_markers()});
})

var get_set_options = function() {
  ret_array = []
  for (option in filters) {
    if (filters[option]) {
      ret_array.push(option)
    }
  }
  return ret_array;
}

var filter_markers = function() {  
  set_filters = get_set_options()
  
  // for each marker, check to see if all required options are set
  for (i = 0; i < markers.length; i++) {
    marker = markers[i];

    // start the filter check assuming the marker will be displayed
    // if any of the required features are missing, set 'keep' to false
    // to discard this marker
    keep=true
    for (opt=0; opt<set_filters.length; opt++) {
      if (!marker.properties[set_filters[opt]]) {
        keep = false;
      }
    }
    marker.setVisible(keep)
  }
}

var map_filter = function(id_val) {
   if (filters[id_val]) 
      filters[id_val] = false
   else
      filters[id_val] = true
}

    var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
    var icons = {
          sail: {icon: iconBase + 'sailing.png'},
          trail: {icon: iconBase + 'trail.png'},
          hike: {icon: iconBase + 'hiker.png'}};

function loadMarkers() {
    $.each(data, function(key, val) {
        var point = new google.maps.LatLng(val['fields']['latitude'], val['fields']['longitude']);
        var titleText = val['fields']['title']
        var descriptionText = val['fields']['description']
        var json_tour_icon = val['fields']['tour_icon']

        var marker = new google.maps.Marker({
            position: point,
            map: map,
            properties: val['fields'],
            title: titleText,
            icon: icons[json_tour_icon.toString()].icon
       });

      google.maps.event.addListener(marker, 'click', (function(marker) {
            return function() {
                infoWindow.setContent(titleText);
                infoWindow.open(map, marker);
            }
        })(marker));
        var markerInfo = "<div><h3>" + titleText + "</h3>Amenities: " + descriptionText + "</div>"
         markers.push(marker)
 })};

google.maps.event.addDomListener(window, 'load', initMap);

</script>

<div id="buttons">

  <input type="checkbox" name="filter" id="bike">
  <label for='shower'>Hike</label>
  
  <input type="checkbox" name="filter" id="trail">
  <label for='flush'>Trail</label>
  
  <input type="checkbox" name="filter" id="sail">
  <label for='vault'>Sail</label>
  <br>
</div>
<br>
<div id="campground_info"></div>

{% endblock content %}
</html>