{% extends "base.html" %}
{% load staticfiles %}
{% load static %}
{% load review_tags %}

{% block extrahead %}{% endblock %}

<style>
  {% block style %}
html,
body,
#map-canvas {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
}

#pac-input {
    left: 831px;
    margin-top: 30px;
    width: 50%;
    height: 50px;
    font-size: 20;
}
  {% endblock style %}
</style>


<body >
{% block content %}
{% include 'navbar.html' %}

<div id="buttons">
  
  <input type="checkbox" name="filter" id="sail" class='chk-btn'>
  <label for='sail'>Sail</label>
  
  <input type="checkbox" name="filter" id="trail" class='chk-btn'>
  <label for='trail'>Trail</label>
  
  <input type="checkbox" name="filter" id="hike" class='chk-btn'>
  <label for='hike'>Hike</label>
  <br>
</div>


<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places"></script>
<div class="container" id="map-canvas"></div>

<script>

 function init() {
   var map = new google.maps.Map(document.getElementById('map-canvas'), {
     center: {
       lat: 12.9715987,
       lng: 77.59456269999998
     },
     zoom: 10
   });
   var searchBox = new google.maps.places.SearchBox(document.getElementById('pac-input'));
   map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById('pac-input'));
   
    google.maps.event.addListener(searchBox, 'places_changed', function() {
     
    searchBox.set('map', null);
    var places = searchBox.getPlaces();
    var bounds = new google.maps.LatLngBounds();
    var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
    var icons = {
          sail: {icon: iconBase + 'sailing.png'},
          trail: {icon: iconBase + 'trail.png'},
          hike: {icon: iconBase + 'hiker.png'}};



    var markers = [
      {% for point in occurrence_list %}
          {% if point.latitude == None %}
          {% else %}
              ["{{point.title}}", {{ point.latitude }}, {{ point.longitude }}, "{{point.tour_icon}}"],
          {% endif %}
      {% endfor%}
      ]

    // Multiple Markers
    var infoWindowContent = [
      {% for point in occurrence_list %}
          {% if point.latitude == None %}
          {% else %}
         ['<div class="info_content">' +
          '<h3>{{point.title}}</h3>' +
          '<p>{{point.description}}</p>' + '</div>'],
          {% endif %}
      {% endfor%}
      ];

    // Display multiple markers on a map
     var infoWindow = new google.maps.InfoWindow(), marker, i;

     var i, place;
     for (i = 0; i < markers.length; i++) {
      var position = new google.maps.LatLng(markers[i][1], markers[i][2]);
       (function(place) {
         var marker = new google.maps.Marker({
           // position: place.geometry.location
           position: position,
           map: map,
           icon: icons[markers[i][3]].icon,
           title: markers[i][0],
         });


            google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
                infoWindow.setContent(infoWindowContent[i][0]);
                infoWindow.open(map, marker);
            }
        })(marker, i));

         marker.bindTo('map', searchBox, 'map');
         google.maps.event.addListener(marker, 'map_changed', function() {
           if (!this.getMap()) {
             this.unbindAll();
           }
         });
         bounds.extend(places[0].geometry.location);
       }(place));

     }
     map.fitBounds(bounds);
     searchBox.set('map', map);
     map.setZoom(Math.min(map.getZoom(),12));
   });
 }
 google.maps.event.addDomListener(window, 'load', init);

    </script>

<input id="pac-input" class="controls" type="text" class="form-control" placeholder="Search Box">

{% endblock content %}
</html>


