{% extends "base.html" %}
{% load i18n staticfiles scheduletags %}

{% block content %}
{% include "navbar.html" %}

    <style>
    table {
    border-collapse: collapse;
    width: 100%;
}

th, td {
    text-align: left;
    padding: 8px;
}

tr:nth-child(even){background-color: #f2b820}

    </style>



<!--     <div class="page text-center">
      <main class="page-content">
        <section>
          <div data-on="false" data-md-on="true" class="rd-parallax">
            <div data-speed="0.25" data-type="media" data-url="{% static 'img/backgrounds/background-20-1920x900.jpg' %}" class="rd-parallax-layer"></div>
            <div data-speed="0" data-type="html" data-md-fade="false" class="rd-parallax-layer">
              <div class="shell section-80 section-md-top-135 section-md-bottom-145">
                <div class="range range-xs-center">
                  <div class="cell-xs-9 cell-sm-7 cell-md-5 cell-lg-12">
                    <div class="box box-lg reveal-block bg-white inset-lg-left-60 inset-lg-right-60">
                      <h5 class="text-ubold text-sm-left">Schedule Views</h5>
                      <div class="offset-top-25">
                          <div class="navigation">
                            <a class="btn btn-primary gradient" href="{% url "day_calendar" event.calendar.slug %}{% querystring_for_date event.start 3 %}">
                              {% trans "Day" %}
                            </a>
                            <a class="btn btn-primary gradient" href="{% url "month_calendar" event.calendar.slug %}{% querystring_for_date event.start 2 %}">
                              {% trans "Month" %}
                            </a>
                            <a class="btn btn-primary gradient" href="{% url "year_calendar" event.calendar.slug %}{% querystring_for_date event.start 1 %}">
                              {% trans "Year" %}
                            </a>
                          </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>  -->




<!-- {% if event.description %}
    <div class="page text-center">
      <main class="page-content">
        <section>
          <div data-on="false" data-md-on="true" class="rd-parallax">
            <div data-speed="0.25" data-type="media" data-url="{% static 'img/backgrounds/background-09-1920x900.jpg' %}" class="rd-parallax-layer"></div>
            <div data-speed="0" data-type="html" data-md-fade="false" class="rd-parallax-layer">
              <div class="shell section-80 section-md-top-135 section-md-bottom-145">
                <div class="range range-xs-center">
                  <div class="cell-xs-9 cell-sm-7 cell-md-5 cell-lg-12">
                    <div class="box box-lg reveal-block bg-white inset-lg-left-60 inset-lg-right-60">
                      <h5 class="text-ubold text-sm-left">{% trans "Description" %}</h5>
                      <div class="offset-top-25">
                          <div class="container">
                              <br>
                              <div class="event_actions" align="center">
                                {% if back_url %}
                                <a href="{{ back_url }}">
                                  <span class="glyphicon glyphicon-circle-arrow-left"></span>
                                </a>
                                &nbsp;
                                {% endif %}
                                <a href="{% url "edit_event" event.calendar.slug event.id %}">
                                 {% trans "Edit" %} <span class="glyphicon glyphicon-pencil"></span>
                                </a>
                                &nbsp;
                                <a href="{% url "delete_event" event.id %}">
                                 {% trans "Delete" %} <span class="glyphicon glyphicon-remove"></span>
                                </a>
                              </div>
                              <h2 align="center">{{event.title}}</h2>
                              <table align="center" class="table table-hover">
                                  <tr>
                                    <td>{% trans "Starts" %}</td>
                                    <td>{% blocktrans with event.start|date:_("DATETIME_FORMAT") as start_date %}{{ start_date }}{% endblocktrans %}</td>
                                  </tr>
                                  <tr>
                                    <td>{% trans "Ends" %}</td>
                                    <td>{% blocktrans with event.end|date:_("DATETIME_FORMAT") as end_date %}{{ end_date }}{% endblocktrans %}</td>
                                  </tr>
                                  <tr>
                                    <td>{% trans "Reoccurs" %}</td>
                                  {% if event.rule %}
                                    <td>{{ event.rule.name }} {% trans "until" %} {% blocktrans with event.end_recurring_period|date:_("DATETIME_FORMAT") as end_recurring_date %}{{ end_recurring_date }}{% endblocktrans %}</td>
                                  {% else %}
                                    <td>{% trans "Never. This is a 'one time only' event." %}</td>
                                  {% endif %}
                                  </tr>
                              </table>
                              <br>
                              </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
{% endif %} -->


       <!-- RD Parallax-->
        <section class="section-height-mac context-dark">
          <!-- RD Parallax-->
          <div data-on="false" data-md-on="true" class="rd-parallax">
            <div data-speed="0.25" data-type="media" data-url="{% static 'img/backgrounds/background-09-1920x900.jpg' %}" class="rd-parallax-layer"></div>
            <div data-speed="0" data-type="html" data-md-fade="false" class="rd-parallax-layer">
              <div class="shell">
                <div class="range">
                  <div class="range range-xs-center range-xs-middle section-34 section-md-top-145 section-md-bottom-100 section-lg-top-100 section-cover">
                    <div class="container col-sm-8">
                      <h1 class="veil reveal-md-inline-block">{{event.title}}</h1>
                      <div class="offset-top-4">
                        <h6 class="text-italic">{{event.description}}</h6>
                      </div>
                    </div>
                    <div class="container col-sm-4">
                      <h4 class="veil reveal-md-inline-block">Check for Tour Dates</h4>
                      <form id="tour-date-checker-form">
                            <div class="cell-sm-10 cell-md-3 offset-top-50 offset-md-top-0 text-md-left">
                              <aside class="blog-aside box box-xs reveal-block bg-white">
                                <p class="text-gray-base text-ubold text-uppercase text-spacing-200">Search</p>
                                <div class="offset-top-20">

                                    <div class="form-blog-search">
                                      <button class="form-search-submit"><span><img src="{% static 'img/icons/icon-16-16x15.png' %}" width="16" height="21" alt="" class="img-responsive center-block"></span></button>
                                      <div class="form-group form-group-xs">
                                        <input id="event-id" name="event-id" type="hidden" value="{{event.id}}">
                                        <label for="tour-date-checker" class="form-label form-search-label form-label-sm"></label>
                                        <input id="tour-date-checker" name='query-date' type="date" class="form-search-input input-sm form-control">
                                      </div>
                                    </div>
                                </div>
                                <div class="offset-top-40">
                                  <hr class="hr bg-gallery">
                                </div>
                                <div class="offset-top-60">
                                  <hr class="hr bg-gallery">
                                </div>
                                <div class="offset-top-30">
                                  <p class="text-gray-base text-ubold text-uppercase text-spacing-200">Find Tour Dates</p>
                                  <div class="offset-top-25 offset-md-top-40"><a href="" class="btn btn-primary" id="tour-checker-button">Check For Events</a></div>
                                </div>
                              </aside>
                            </div>
                      </form>



                    </div>


                    <table id="tour-table" border="1" cellpadding="0" cellspacing="0" width="85%">
                           <thead>
                              <col width="100">
                              <col width="70">
                              <col width="70">
                              <col width="100">
                              <tr bgcolor="#RRRRRR">
                                  <th>Start</th>
                                  <th>End</th>
                                  <th>Spot Avaliable</th>
                                  <th>View This Tour</th>
                              </tr>
                           </thead>
                          <tbody>
                    </table>     
                  </div>
                </div>
              </div>
            </div>



          </div>
        </section>

      <!-- Page Content-->
      <main class="page-content">
        <!-- Tour Single-->
        <section class="section-34 section-md-bottom-45 bg-alabaster">
          <div class="shell">
            <div class="range range-xs-center">
              <div class="cell-xs-10 cell-sm-8 cell-md-12">
                <div class="range range-xs-center list-inline-dashed-vertival">
                  <div class="cell-xs-6 cell-sm-5 cell-md-3 offset-top-40 offset-xs-top-0">
                    <div>
                      <p class="text-extra-small text-silver-chalice text-italic text-uppercase text-spacing-200">DURATION</p>
                    </div>
                    <div class="offset-top-0">
                      <p class="text-big text-ubold text-gray-base text-uppercase">10 Days</p>
                    </div>
                  </div>
                  <div class="cell-xs-6 cell-sm-5 cell-md-3 offset-top-40 offset-md-top-0">
                    <div>
                      <p class="text-extra-small text-silver-chalice text-italic text-uppercase text-spacing-200">PRICE</p>
                    </div>
                    <div class="offset-top-0">
                      <p class="text-big text-ubold text-gray-base text-uppercase">${{event.price}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
  
        <section>
          <div data-photo-swipe-gallery="gallery" data-items="1" data-sm-items="2" data-md-items="3" data-lg-items="5" data-stage-padding="20" data-loop="true" data-margin="6" data-mouse-drag="false" data-dots="true" data-nav="true" class="owl-carousel owl-carusel-inset-bottom owl-nav-type-3 owl-dots-primary offset-top-45" >
            <div class="owl-item">
              <!-- Thumbnail Rayen--><a data-photo-swipe-item="" data-size="1170x781" href="{% static 'img/gallery/portfolio-06-1170x781_original.jpg' %}" class="thumbnail-rayen"><span class="figure"><img width="370" height="310" src="{% static 'img/gallery/portfolio-06-1170x781_original.jpg' %}" alt="" class="img-responsive center-block"><span class="figcaption"><span class="icon icon-xl fa fa-search-plus text-white"></span></span></span></a>
            </div>
            <div class="owl-item">
              <!-- Thumbnail Rayen--><a data-photo-swipe-item="" data-size="1170x781" href="{% static 'img/gallery/portfolio-07-1170x780_original.jpg' %}" class="thumbnail-rayen"><span class="figure"><img width="370" height="310" src="{% static 'img/gallery/portfolio-07-1170x780_original.jpg' %}" alt="" class="img-responsive center-block"><span class="figcaption"><span class="icon icon-xl fa fa-search-plus text-white"></span></span></span></a>
            </div>
            <div class="owl-item">
              <!-- Thumbnail Rayen--><a data-photo-swipe-item="" data-size="1170x781" href="{% static 'img/gallery/portfolio-07-1170x780_original.jpg' %}" class="thumbnail-rayen"><span class="figure"><img width="370" height="310" src="{% static 'img/gallery/portfolio-03-1170x780_original.jpg' %}" alt="" class="img-responsive center-block"><span class="figcaption"><span class="icon icon-xl fa fa-search-plus text-white"></span></span></span></a>
            </div>
            <div class="owl-item">
              <!-- Thumbnail Rayen--><a data-photo-swipe-item="" data-size="1170x781" href="{% static 'img/gallery/portfolio-07-1170x780_original.jpg' %}" class="thumbnail-rayen"><span class="figure"><img width="370" height="310" src="{% static 'img/gallery/portfolio-08-1170x780_original.jpg' %}" alt="" class="img-responsive center-block"><span class="figcaption"><span class="icon icon-xl fa fa-search-plus text-white"></span></span></span></a>
            </div>
            <div class="owl-item">
              <!-- Thumbnail Rayen--><a data-photo-swipe-item="" data-size="1170x781" href="{% static 'img/gallery/portfolio-07-1170x780_original.jpg' %}" class="thumbnail-rayen"><span class="figure"><img width="370" height="310" src="{% static 'img/gallery/portfolio-11-1170x778_original.jpg' %}" alt="" class="img-responsive center-block"><span class="figcaption"><span class="icon icon-xl fa fa-search-plus text-white"></span></span></span></a>
            </div>
            <div class="owl-item">
              <!-- Thumbnail Rayen--><a data-photo-swipe-item="" data-size="1170x781" href="{% static 'img/gallery/portfolio-07-1170x780_original.jpg' %}" class="thumbnail-rayen"><span class="figure"><img width="370" height="310" src="{% static 'img/gallery/portfolio-10-1170x780_original.jpg' %}" alt="" class="img-responsive center-block"><span class="figcaption"><span class="icon icon-xl fa fa-search-plus text-white"></span></span></span></a>
            </div>
          </div>
        </section>
      </main>




     <script>

     $('#tour-checker-button').click(function(event){
          event.preventDefault();

          var formData = $("#tour-date-checker-form").serialize();
          $.ajax({
               type: "GET",
               url: "{% url 'create_tour_guide' %}",
               data: formData,
               success: function(data){
                   var endDate;
                   var endTime;
                   var startDate;
                   var startTime;
                   var newData = JSON.parse(data.json_list);
                   $('#tours-length').text(newData.length);
                   for (var i = 0; i < newData.length; i++) {
                       console.log(newData[i]);
                       startTime = Date.parse(newData[i]['fields']['start']);
                       startDate = new Date(startTime);
                       endTime = Date.parse(newData[i]['fields']['end']);
                       endDate = new Date(endTime);
                      var Markup = "<tr><td>" + startDate.getHours() + ":" + startDate.getMinutes() +"</td><td>"+endDate.getHours() + ":" + endDate.getMinutes()+"</td><td>"+newData[i]['fields']['spots_free'] + "</td><td>"+ '<div><a href="" class="btn btn-primary" data-event="' + {{event.id}} + '" id="tour-booking" value="' + startDate.getTime() + '"" data-hour="' + startDate.getUTCHours() + '" data-minutes="' + startDate.getMinutes() + '" data-seconds="' + startDate.getSeconds() + '">View This Date</a></div>' + "</td></tr>";
                      $('#tour-table').find("tbody").append(Markup);
                  }
               },
               error: function(response, error) {
                  console.log('tour-checker-button ' + error)
               }
          })
     });



    $('body').on('click', '#tour-booking', function (event) {
     event.preventDefault();
        var bookingDate = $(event.target).attr('value');
        var eventID = $(event.target).attr('data-event');
        var hour = $(event.target).attr('data-hour');


        var data = {
            bookingDate: bookingDate,
            eventID: eventID,
            hour: hour
        };

        $.ajax({
             type: "GET",
             url: "{% url 'tour_booker' %}",
             data: data,
             success: function(data){
                window.location.href = data.url;
             },
             error: function(response, error) {
                 console.log(error)
             }
        })
    });


     </script>


{% endblock %}